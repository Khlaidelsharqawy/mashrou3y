<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - MASHROU3Y</title>

  <!-- Tailwind CSS & Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="components/header.css">

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Scripts -->
  <script type="module" src="supabase-config.js" defer></script>
  <script type="module" src="translations.js" defer></script>
  <script type="module" src="theme.js" defer></script>
  <script type="module" src="utils.js" defer></script>
  <script type="module" src="components/header.js" defer></script>

  <style>
    body { 
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .glass-container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .form-input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }
    
    .form-input:focus {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.4);
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
      transform: scale(1.02);
    }
    
    .form-select {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(10px);
    }
    
    .form-select option {
      background: #1f2937;
      color: white;
    }
    
    .step-indicator {
      transition: all 0.3s ease;
    }
    
    .step-indicator.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    
    .step-indicator.completed {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }
    
    .fade-in {
      animation: fadeIn 0.8s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in {
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(50px); }
      to { opacity: 1; transform: translateX(0); }
    }
  </style>
</head>
<body class="flex items-center justify-center p-4">
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
      <p class="text-white font-medium">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</p>
    </div>
  </div>

  <div class="w-full max-w-2xl fade-in">
    <!-- Header -->
    <div class="text-center mb-8">
      <img src="logo2.jpg" alt="Ø´Ø¹Ø§Ø± MASHROU3Y" class="w-16 h-16 mx-auto rounded-xl shadow-2xl mb-4">
      <h1 class="text-3xl font-bold text-white mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ MASHROU3Y</h1>
      <p class="text-white/80">ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
    </div>

    <!-- Step Indicator -->
    <div class="flex justify-center mb-8">
      <div class="flex items-center space-x-4 space-x-reverse">
        <div class="step-indicator active w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold">
          1
        </div>
        <div class="w-8 h-1 bg-white/20 rounded"></div>
        <div class="step-indicator w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold bg-white/20 text-white/60">
          2
        </div>
        <div class="w-8 h-1 bg-white/20 rounded"></div>
        <div class="step-indicator w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold bg-white/20 text-white/60">
          3
        </div>
      </div>
    </div>

    <!-- Profile Completion Form -->
    <div class="glass-container p-8 rounded-2xl shadow-2xl">
      <form id="profileForm" class="space-y-6">
        <!-- Step 1: Basic Information -->
        <div id="step1" class="space-y-6">
          <h3 class="text-xl font-bold text-white text-center mb-6">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="full_name" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
              <input 
                type="text" 
                id="full_name" 
                placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" 
                class="form-input w-full p-4 rounded-lg" 
                required
              >
            </div>
            
            <div>
              <label for="phone" class="block text-white/90 text-sm font-medium mb-2">Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† *</label>
              <input 
                type="tel" 
                id="phone" 
                placeholder="01xxxxxxxxx" 
                class="form-input w-full p-4 rounded-lg" 
                required
              >
            </div>
          </div>
          
          <div>
            <label for="user_type" class="block text-white/90 text-sm font-medium mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ *</label>
            <select id="user_type" class="form-select w-full p-4 rounded-lg" required>
              <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</option>
              <option value="student">Ø·Ø§Ù„Ø¨ Ø¬Ø§Ù…Ø¹ÙŠ</option>
              <option value="instructor">Ù…Ù†Ø´Ø¦ Ù…Ø­ØªÙˆÙ‰ / Ù…Ø¯Ø±Ø³</option>
              <option value="freelancer">ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±</option>
              <option value="store_owner">ØµØ§Ø­Ø¨ Ù…ØªØ¬Ø±</option>
            </select>
          </div>
          
          <div>
            <label for="location" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
            <select id="location" class="form-select w-full p-4 rounded-lg" required>
              <option value="">Ø§Ø®ØªØ± Ù…Ø­Ø§ÙØ¸ØªÙƒ</option>
              <option value="cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
              <option value="giza">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
              <option value="alexandria">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
              <option value="dakahlia">Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©</option>
              <option value="gharbia">Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
              <option value="menoufia">Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
              <option value="qalyubia">Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©</option>
              <option value="kafr_el_sheikh">ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</option>
              <option value="beheira">Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</option>
              <option value="sharqia">Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
              <option value="damietta">Ø¯Ù…ÙŠØ§Ø·</option>
              <option value="port_said">Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯</option>
              <option value="ismailia">Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©</option>
              <option value="suez">Ø§Ù„Ø³ÙˆÙŠØ³</option>
              <option value="north_sinai">Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡</option>
              <option value="south_sinai">Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡</option>
              <option value="red_sea">Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±</option>
              <option value="luxor">Ø§Ù„Ø£Ù‚ØµØ±</option>
              <option value="aswan">Ø£Ø³ÙˆØ§Ù†</option>
              <option value="qena">Ù‚Ù†Ø§</option>
              <option value="sohag">Ø³ÙˆÙ‡Ø§Ø¬</option>
              <option value="assiut">Ø£Ø³ÙŠÙˆØ·</option>
              <option value="minya">Ø§Ù„Ù…Ù†ÙŠØ§</option>
              <option value="beni_suef">Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
              <option value="fayoum">Ø§Ù„ÙÙŠÙˆÙ…</option>
              <option value="matrouh">Ù…Ø·Ø±ÙˆØ­</option>
              <option value="new_valley">Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</option>
            </select>
          </div>
        </div>

        <!-- Step 2: Educational Information (for students/instructors) -->
        <div id="step2" class="space-y-6 hidden">
          <h3 class="text-xl font-bold text-white text-center mb-6">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="university" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</label>
              <select id="university" class="form-select w-full p-4 rounded-lg">
                <option value="">Ø§Ø®ØªØ± Ø¬Ø§Ù…Ø¹ØªÙƒ</option>
                <option value="cairo_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
                <option value="ain_shams_university">Ø¬Ø§Ù…Ø¹Ø© Ø¹ÙŠÙ† Ø´Ù…Ø³</option>
                <option value="helwan_university">Ø¬Ø§Ù…Ø¹Ø© Ø­Ù„ÙˆØ§Ù†</option>
                <option value="alexandria_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                <option value="mansoura_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©</option>
                <option value="zagazig_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚</option>
                <option value="tanta_university">Ø¬Ø§Ù…Ø¹Ø© Ø·Ù†Ø·Ø§</option>
                <option value="menoufia_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
                <option value="assiut_university">Ø¬Ø§Ù…Ø¹Ø© Ø£Ø³ÙŠÙˆØ·</option>
                <option value="minia_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù†ÙŠØ§</option>
                <option value="sohag_university">Ø¬Ø§Ù…Ø¹Ø© Ø³ÙˆÙ‡Ø§Ø¬</option>
                <option value="beni_suef_university">Ø¬Ø§Ù…Ø¹Ø© Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
                <option value="fayoum_university">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙÙŠÙˆÙ…</option>
                <option value="suez_canal_university">Ø¬Ø§Ù…Ø¹Ø© Ù‚Ù†Ø§Ø© Ø§Ù„Ø³ÙˆÙŠØ³</option>
                <option value="port_said_university">Ø¬Ø§Ù…Ø¹Ø© Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯</option>
                <option value="damietta_university">Ø¬Ø§Ù…Ø¹Ø© Ø¯Ù…ÙŠØ§Ø·</option>
                <option value="kafr_elsheikh_university">Ø¬Ø§Ù…Ø¹Ø© ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</option>
                <option value="other">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
            
            <div>
              <label for="faculty" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„ÙƒÙ„ÙŠØ©</label>
              <input 
                type="text" 
                id="faculty" 
                placeholder="Ù…Ø«Ø§Ù„: ÙƒÙ„ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©" 
                class="form-input w-full p-4 rounded-lg"
              >
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="specialization" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„ØªØ®ØµØµ</label>
              <input 
                type="text" 
                id="specialization" 
                placeholder="Ù…Ø«Ø§Ù„: Ù‡Ù†Ø¯Ø³Ø© Ø­Ø§Ø³Ø¨Ø§Øª" 
                class="form-input w-full p-4 rounded-lg"
              >
            </div>
            
            <div>
              <label for="academic_year" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
              <select id="academic_year" class="form-select w-full p-4 rounded-lg">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©</option>
                <option value="1">Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
                <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
                <option value="3">Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
                <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option>
                <option value="5">Ø§Ù„Ø®Ø§Ù…Ø³Ø©</option>
                <option value="graduate">Ø®Ø±ÙŠØ¬</option>
                <option value="postgraduate">Ø¯Ø±Ø§Ø³Ø§Øª Ø¹Ù„ÙŠØ§</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Step 3: Professional Information (for freelancers/store owners) -->
        <div id="step3" class="space-y-6 hidden">
          <h3 class="text-xl font-bold text-white text-center mb-6">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</h3>
          
          <div id="skills-section" class="hidden">
            <label for="skills" class="block text-white/90 text-sm font-medium mb-2">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª (Ù„Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±Ø²)</label>
            <textarea 
              id="skills" 
              placeholder="Ø§ÙƒØªØ¨ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„ Ù…Ø«Ù„: ØªØµÙ…ÙŠÙ… Ù…ÙˆØ§Ù‚Ø¹ØŒ Ø¨Ø±Ù…Ø¬Ø©ØŒ ØªØ±Ø¬Ù…Ø©"
              class="form-input w-full p-4 rounded-lg h-24 resize-none"
            ></textarea>
          </div>
          
          <div id="store-section" class="hidden">
            <div>
              <label for="store_name" class="block text-white/90 text-sm font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
              <input 
                type="text" 
                id="store_name" 
                placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…ØªØ¬Ø±Ùƒ" 
                class="form-input w-full p-4 rounded-lg"
              >
            </div>
            
            <div>
              <label for="store_category" class="block text-white/90 text-sm font-medium mb-2">ÙØ¦Ø© Ø§Ù„Ù…ØªØ¬Ø±</label>
              <select id="store_category" class="form-select w-full p-4 rounded-lg">
                <option value="">Ø§Ø®ØªØ± ÙØ¦Ø© Ø§Ù„Ù…ØªØ¬Ø±</option>
                <option value="books">ÙƒØªØ¨ ÙˆÙ…Ø±Ø§Ø¬Ø¹</option>
                <option value="electronics">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                <option value="stationery">Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØªØ¨ÙŠØ©</option>
                <option value="clothing">Ù…Ù„Ø§Ø¨Ø³</option>
                <option value="food">Ø·Ø¹Ø§Ù… ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª</option>
                <option value="services">Ø®Ø¯Ù…Ø§Øª</option>
                <option value="other">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
          </div>
          
          <div>
            <label for="bio" class="block text-white/90 text-sm font-medium mb-2">Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©</label>
            <textarea 
              id="bio" 
              placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù†Ùƒ"
              class="form-input w-full p-4 rounded-lg h-24 resize-none"
            ></textarea>
          </div>
        </div>

        <!-- Message Display -->
        <div id="message" class="text-center p-3 rounded-lg hidden"></div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between items-center pt-6">
          <button type="button" id="prevBtn" class="px-6 py-3 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-all duration-200 hidden">
            <i class="fas fa-arrow-right ml-2"></i>
            Ø§Ù„Ø³Ø§Ø¨Ù‚
          </button>
          
          <button type="button" id="nextBtn" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105">
            Ø§Ù„ØªØ§Ù„ÙŠ
            <i class="fas fa-arrow-left mr-2"></i>
          </button>
          
          <button type="submit" id="submitBtn" class="px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 hidden">
            <i class="fas fa-check ml-2"></i>
            Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
          </button>
        </div>
      </form>
    </div>
  </div>

  <script type="module">
    import { getSupabaseClient } from './supabase-config.js';

    class ProfileCompletion {
      constructor() {
        this.supabase = null;
        this.currentStep = 1;
        this.totalSteps = 3;
        this.userData = {};
        this.init();
      }

      async init() {
        try {
          // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase
          while (!window.supabaseClient) {
            await new Promise(resolve => setTimeout(resolve, 100));
          }
          
          this.supabase = window.supabaseClient;
          await this.checkAuthentication();
          await this.loadUserData();
          this.bindEvents();
          this.updateStepVisibility();
          console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©:', error);
          this.showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø¬Ø±Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'error');
        }
      }

      async checkAuthentication() {
        const { data: { session } } = await this.supabase.auth.getSession();
        if (!session) {
          window.location.href = 'login.html';
          return;
        }
        this.userData = session.user;
      }

      async loadUserData() {
        if (this.userData.user_metadata) {
          // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
          const metadata = this.userData.user_metadata;
          
          if (metadata.full_name) {
            document.getElementById('full_name').value = metadata.full_name;
          }
          
          if (metadata.email) {
            document.getElementById('email').value = metadata.email;
          }
        }
      }

      bindEvents() {
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
        document.getElementById('nextBtn').addEventListener('click', () => {
          this.nextStep();
        });
        
        document.getElementById('prevBtn').addEventListener('click', () => {
          this.prevStep();
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('profileForm').addEventListener('submit', (e) => {
          this.handleSubmit(e);
        });
        
        // ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨
        document.getElementById('user_type').addEventListener('change', (e) => {
          this.handleUserTypeChange(e.target.value);
        });
      }

      handleUserTypeChange(userType) {
        const skillsSection = document.getElementById('skills-section');
        const storeSection = document.getElementById('store-section');
        
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
        skillsSection.classList.add('hidden');
        storeSection.classList.add('hidden');
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        if (userType === 'freelancer') {
          skillsSection.classList.remove('hidden');
          this.totalSteps = 3;
        } else if (userType === 'store_owner') {
          storeSection.classList.remove('hidden');
          this.totalSteps = 3;
        } else if (userType === 'student' || userType === 'instructor') {
          this.totalSteps = 3; // Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†
        } else {
          this.totalSteps = 2; // Ø®Ø·ÙˆØªØ§Ù† ÙÙ‚Ø· Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø®Ø±Ù‰
        }
        
        this.updateStepIndicator();
      }

      nextStep() {
        if (this.validateCurrentStep()) {
          if (this.currentStep < this.totalSteps) {
            this.currentStep++;
            this.updateStepVisibility();
            this.updateStepIndicator();
          }
        }
      }

      prevStep() {
        if (this.currentStep > 1) {
          this.currentStep--;
          this.updateStepVisibility();
          this.updateStepIndicator();
        }
      }

      validateCurrentStep() {
        const currentStepEl = document.getElementById(`step${this.currentStep}`);
        const requiredFields = currentStepEl.querySelectorAll('[required]');
        
        for (let field of requiredFields) {
          if (!field.value.trim()) {
            field.focus();
            this.showMessage(`ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø­Ù‚Ù„ ${field.previousElementSibling.textContent}`, 'error');
            return false;
          }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†
        if (this.currentStep === 1) {
          const phone = document.getElementById('phone').value;
          if (phone && !this.validatePhone(phone)) {
            this.showMessage('Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
            return false;
          }
        }
        
        return true;
      }

      validatePhone(phone) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† Ø§Ù„Ù…ØµØ±ÙŠ
        const phoneRegex = /^(01)[0-9]{9}$/;
        return phoneRegex.test(phone);
      }

      updateStepVisibility() {
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª
        for (let i = 1; i <= 3; i++) {
          document.getElementById(`step${i}`).classList.add('hidden');
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const currentStepEl = document.getElementById(`step${this.currentStep}`);
        currentStepEl.classList.remove('hidden');
        currentStepEl.classList.add('slide-in');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        prevBtn.classList.toggle('hidden', this.currentStep === 1);
        nextBtn.classList.toggle('hidden', this.currentStep === this.totalSteps);
        submitBtn.classList.toggle('hidden', this.currentStep !== this.totalSteps);
        
        // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©
        if (this.currentStep === 2) {
          const userType = document.getElementById('user_type').value;
          if (userType !== 'student' && userType !== 'instructor') {
            this.nextStep(); // ØªØ®Ø·ÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
          }
        }
      }

      updateStepIndicator() {
        const indicators = document.querySelectorAll('.step-indicator');
        
        indicators.forEach((indicator, index) => {
          const stepNumber = index + 1;
          
          indicator.classList.remove('active', 'completed');
          
          if (stepNumber < this.currentStep) {
            indicator.classList.add('completed');
          } else if (stepNumber === this.currentStep) {
            indicator.classList.add('active');
          }
        });
      }

      async handleSubmit(e) {
        e.preventDefault();
        
        if (!this.validateCurrentStep()) {
          return;
        }

        try {
          this.setLoading(true);
          this.showMessage('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');

          // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          const formData = this.collectFormData();
          
          // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Supabase
          const { error } = await this.supabase.auth.updateUser({
            data: {
              ...formData,
              profile_completed: true,
              completed_at: new Date().toISOString()
            }
          });

          if (error) throw error;

          // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ ÙÙŠ Ø¬Ø¯ÙˆÙ„ profiles
          const { error: profileError } = await this.supabase
            .from('profiles')
            .upsert([{
              id: this.userData.id,
              email: this.userData.email,
              ...formData,
              updated_at: new Date().toISOString()
            }]);

          if (profileError) throw profileError;

          this.showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'success');
          
          // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
          setTimeout(() => {
            window.location.href = 'dashboard.html';
          }, 2000);

        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
          this.showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
        } finally {
          this.setLoading(false);
        }
      }

      collectFormData() {
        const formData = {
          full_name: document.getElementById('full_name').value,
          phone: document.getElementById('phone').value,
          user_type: document.getElementById('user_type').value,
          location: document.getElementById('location').value,
          university: document.getElementById('university').value,
          faculty: document.getElementById('faculty').value,
          specialization: document.getElementById('specialization').value,
          academic_year: document.getElementById('academic_year').value,
          skills: document.getElementById('skills').value,
          store_name: document.getElementById('store_name').value,
          store_category: document.getElementById('store_category').value,
          bio: document.getElementById('bio').value
        };

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙØ§Ø±ØºØ©
        Object.keys(formData).forEach(key => {
          if (!formData[key]) {
            delete formData[key];
          }
        });

        return formData;
      }

      setLoading(loading) {
        const overlay = document.getElementById('loading-overlay');
        const submitBtn = document.getElementById('submitBtn');
        
        if (loading) {
          overlay.classList.remove('hidden');
          submitBtn.disabled = true;
          submitBtn.classList.add('opacity-50');
        } else {
          overlay.classList.add('hidden');
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-50');
        }
      }

      showMessage(text, type = 'info') {
        const messageEl = document.getElementById('message');
        messageEl.textContent = text;
        messageEl.className = `text-center p-3 rounded-lg ${this.getMessageClasses(type)}`;
        messageEl.classList.remove('hidden');
        
        if (type !== 'success') {
          setTimeout(() => {
            messageEl.classList.add('hidden');
          }, 5000);
        }
      }

      getMessageClasses(type) {
        switch (type) {
          case 'success':
            return 'bg-green-500/20 border border-green-500/50 text-green-100';
          case 'error':
            return 'bg-red-500/20 border border-red-500/50 text-red-100';
          case 'warning':
            return 'bg-yellow-500/20 border border-yellow-500/50 text-yellow-100';
          default:
            return 'bg-blue-500/20 border border-blue-500/50 text-blue-100';
        }
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    document.addEventListener('DOMContentLoaded', () => {
      window.profileCompletion = new ProfileCompletion();
    });
  </script>
</body>
</html>